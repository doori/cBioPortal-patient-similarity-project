<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="css/styles.css">


    <!--Required js libraries-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

    <script src="./libs/autocomplete.min.js"></script>



    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./service/CoreClient.js"></script>
    <script src="./service/Api.js"></script>
</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid top-container-nav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a id="cbioportal-logo" href="/"><img
                        src="https://frontend.cbioportal.org/reactapp/images/369b022222badf37b2b0c284f4ae2284.png"
                        alt="cBioPortal Logo" class="cbioportal-logo"></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form class="navbar-form navbar-left">
                    <div class="form-group">
                        <input type="text" class="form-control hidden-component" placeholder="Patients Count"
                            id="patients-count"
                            title="[Optional] The number of patients to be shown that present similar conditions beyond patient zero."
                            data-toggle="tooltip" data-placement="bottom">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control hidden-component" placeholder="Relational Depth"
                            id="patients-graph-depth"
                            title="[Optional] The degree of depth shown as similarities among patients with related conditions."
                            data-toggle="tooltip" data-placement="bottom">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control hidden-component" required="true"
                            placeholder="Select Initial Patient" id="search-field" title="[Required] The initial patient used as base to calculate the similarity
                            network" data-toggle="tooltip" data-placement="bottom">
                        <input type="hidden" id="search-hidden-field">
                    </div>
                    <button type="submit" class="btn btn-default hidden-component" id="btn-do-search">Search</button>
                    <div class="alert alert-warning alert-dismissible hidden-component" id="patient-count-warning">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close"
                            onclick="hideWarning()">&times;</a>
                        <Strong>Please be aware:</Strong> Due to the nature of the similarity network, large counts of
                        patients can result in extremely long processes delays or in a cluttered graph.<br>
                        We suggest not going over 200 patients. The exponential formula to calculate the network
                        is InitialPatient+(PatientsCount^RelationDepth)
                    </div>
                </form>
                <div class="help-tip">
                    <p>
                        Data Provided by <a href="http://cbioportal.org/">cBioPortal</a> <br><br>
                        <b>Patients Count:</b> [Optional] The number of patients to be shown that present similar
                        conditions beyond patient zero.. Default = 35 <br><br>
                        <b>Graph Depth:</b> [Optional] The degree of depth shown as similarities among patients with
                        related conditions. Default = 0<br><br>
                        <b>Initial Patient:</b> [Required] The initial patient used as base to calculate the similarity
                        network.<br><br>
                        <b>Cancer Types Panel:</b> Cancer types shown on the similarity network. Node colors are
                        randomly chosen with each selection.
                        <br><br><br>

                        <i>
                            <b>Please note:</b> The amount of nodes returned will represent the Patient Count
                            variable times Graph Depth. Since we can't foresee the similarity network, the
                            deeper
                            the graph is, and the larger the amount of nodes is, will affect the processing
                            speed
                        </i>
                    </p>
                </div><!-- /.help-tip -->
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>

    <div class="container justify-content-center customContainerWith">
        <div class="row">
            <div class="" style="">
                <div class="col-lg-8 col-md-12 patient-similarity-node-graph panel panel-default overflow-all"
                    id="patient-similarity-node-graph">
                </div>
                <div class="col-lg-4 col-md-12 patient-similarity-node-graph nopadding">
                    <div class="panel panel-default patient-similarity-distribution-graph-1">
                        <div class="panel-heading bold">
                            Distribution of Cancer Types: Top 10 Types
                        </div>
                        <div class="panel-content patient-similarity-distribution-graph-1"
                            id="patient-similarity-cancer-distribution">
                            <div id="patient-similarity-cancer-distribution"></div>
                        </div>
                    </div>

                    <div class="panel panel-default patient-similarity-distribution-graph-2">
                        <div class="panel-heading bold">
                            Cancer Types
                        </div>
                        <div class="panel-content patient-similarity-distribution-graph-2-body"
                            id="patient-similarity-cancer-navigator-content">
                        </div>
                    </div><!-- /.patient-similarity-distribution-graph-2 -->
                </div>

            </div>



        </div>

        <div class="row">
            <!-- <div class="col-lg-11 col-md-12"> -->
            <div class="col-lg-12 col-md-12 nopadding">
                <div class="panel panel-default">
                    <div class="panel-heading bold">
                        Patient Similarity Table
                    </div>
                    <div class="panel-content">
                        <div class="table-responsive div-table">
                            <table class="table table-striped table-hover" id="patients-table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="">Patient Id</th>
                                        <th scope="col">Similarity</th>
                                        <th scope="col">Cancer Type </th>
                                        <th scope="col">Sex</th>
                                        <th scope="col">Vital Status</th>
                                        <th scope="col">Smoking History</th>
                                        <th scope="col">OS Months</th>
                                        <th scope="col">OS Status</th>
                                        <th scope="col">Sample Collection Source</th>
                                        <th scope="col">Specimen Preservation Type</th>
                                        <th scope="col">Specimen Type</th>
                                        <th scope="col">Dna Input</th>
                                        <th scope="col">Sample Coverage</th>
                                        <th scope="col">Tumor Purity</th>
                                        <th scope="col">Matched Status</th>
                                        <th scope="col">Sample Type</th>
                                        <th scope="col">Primary Site</th>
                                        <th scope="col">Metastatic Site</th>
                                        <th scope="col">Sample Class</th>
                                        <th scope="col">Oncotree Code</th>
                                        <th scope="col">Cancer Type Detailed</th>
                                    </tr>
                                </thead>
                                <tbody id="patients-table-body">
                                </tbody>
                            </table>
                        </div><!-- /.table-responsive -->
                    </div>
                </div><!-- /.panel panel-default -->
            </div>
        </div>


    </div><!-- /.container-fluid -->

    <div id="spinner-group">
        <div class="overlay-all">
            &nbsp;
        </div>
        <div class="loader">
            <!-- <div class="loader-h1">Loading Data</div> -->
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
            <div class="nucleobase"></div>
        </div>
    </div><!-- /.spinner-group -->

</body>
<!--Support styles and scripts-->
<link rel="stylesheet" href="d3-content/nodes/style.css">

<script src="d3-content/nodes/node-graph.js"></script>
<script src="d3-content/patientTable/patientTable.js"></script>

<link rel="stylesheet" href="d3-content/cancer-distribution/style.css">
<script src="d3-content/cancer-distribution/cancer-graph.js"></script>

<script src="d3-content/cancer-navigator/cancer-navigator.js"></script>



<script>
    const DEFAULT_MAX_PATIENT_COUNT = 35;
    const DEFAULT_MAX_GRAPH_DEPTH = 0;
    const MAX_SUGGESTED_NODES_TOTAL = 200;
    let showWarning = true;

    let patientList = [];

    $(document).ready(() => {
        $('#patients-table').DataTable();
        $('[data-toggle="tooltip"]').tooltip({ trigger: "hover", delay: { show: 700, hide: 100 } })
    });

    $("form").submit((e) => { e.preventDefault(); });

    $("#patients-count, #patients-graph-depth").on("keyup", () => {
        let patientsCountVal = $("#patients-count").val() == "" ? DEFAULT_MAX_PATIENT_COUNT : $("#patients-count").val();
        let patientsGraphDepthVal = $("#patients-graph-depth").val() == "" ? DEFAULT_MAX_GRAPH_DEPTH : $("#patients-graph-depth").val();

        if (patientsCountVal > MAX_SUGGESTED_NODES_TOTAL || Math.pow(patientsCountVal, patientsGraphDepthVal) > MAX_SUGGESTED_NODES_TOTAL) {
            $("#patient-count-warning").show();
        } else {
            $("#patient-count-warning").hide();
        }
    });

    const hideWarning = () => { showWarning = false; };

    getPatientListInformation().then((list) => {
        $("#spinner-group").hide();

        $('#search-field').autocomplete({
            nameProperty: 'value',
            valueProperty: 'patientId',
            valueField: '#search-hidden-field',
            dataSource: list
        });

        $('#btn-do-search').show();
        $('#search-field').show();

        $("#btn-do-search").click(() => {
            patientList = [];
            patientCancerDistribution = [];

            let patientId = $("#search-hidden-field").val();
            let patientCount = $("#patients-count").val();
            let graphDepth = $("#patients-graph-depth").val();

            if (patientId == "") { return; }

            $("#patient-similarity-node-graph").empty();
            $("#patient-similarity-cancer-distribution").empty();

            $("#spinner-group").show();

            const patientGraphResult = getPatientsSimilarityGraph(patientId, patientCount == "" ? null : patientCount, graphDepth == "" ? null : graphDepth);

            const patientCancerDistributionGraph = getCancerDistributionGraph(patientId);

            Promise.all([patientGraphResult, patientCancerDistributionGraph]).then(() => {
                patientList = getUniquePatientList();
                $("#spinner-group").hide();
                doDrawNodeGraph(patientId);
                doPopulatePatientsTable(patientList);
                doDrawCancerDistributionGraph(patientCancerDistribution);
                doPopulateCancerNavigators(patientList);
            });

            if (patientCount == "") { $("#patients-count").val(DEFAULT_MAX_PATIENT_COUNT); }
            if (graphDepth == "") { $("#patients-graph-depth").val(DEFAULT_MAX_GRAPH_DEPTH); }
        });
    });









</script>

</html>